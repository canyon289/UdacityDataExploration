Differential Analysis of State Donations by Ravin Kumar
========================================================
# Abstract
At time of writing it is November 2015 and the 2016 election year is only monnths away. Since there is no incumbent both parties are running multiple candidates. As a result my curiosity in way candidates fund their campaigns is higher than usual.

The Federal Election Commission requires that candidates publish details of the contributions publically. The dataset holds numerous interesting pieces of information, including contribution amount, donor size code, time of donation etc. I chose to analyze the contributions from California and Wisconsin only. This is an arbitrary choice, made largely because at different points in time I have been registered to vote in each state.



```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(lubridate)
library(scales)
```
```{r cache= TRUE, Load_the_Data}
# Need to specify columns due to trailing comma in files
cols = c("cmte_id","cand_id","cand_nm","contbr_nm","contbr_city","contbr_st",
         "contbr_zip","contbr_employer","contbr_occupation","contb_receipt_amt",
         "contb_receipt_dt","receipt_desc","memo_cd","memo_text","form_tp","file_num",
         "tran_id","election_tp", "DISCARD")

#Load and bind california dataframes
ca_df_2012 = read.csv(unzip("data/P00000001-CA_2012.zip"), col.names = cols, header = F, skip = 1)

ca_df_2016 = read.csv(unzip("data/P00000001-CA_2016.zip"), col.names = cols, header = F, skip = 1)

ca_df = rbind(ca_df_2012, ca_df_2016)

#Load and bind Wisconsin files
wi_df_2012 = read.csv(unzip("data/P00000001-WI_2012.zip"), col.names = cols, header = F, skip = 1)

#Some trouble with letters in zip code
#Removing occurence of letterL
wi_df_2012["contbr_zip"] = gsub("L", "", wi_df_2012[["contbr_zip"]])

#Load and bind 2016 data
wi_df_2016 = read.csv(unzip("data/P00000001-WI_2016.zip"), col.names = cols, header = F, skip = 1)

wi_df = rbind(wi_df_2012, wi_df_2016)

#Bind all into one dataframe
df = rbind(ca_df, wi_df)

#Election_tp columns looks like G2012, Splitting into type and year
df["election_year"] = as.integer(substr(df[["election_tp"]], 2,5))
df["election_type"] = substr(df[["election_tp"]], 0,1)

#Convert Contribution receipt to date
df["contb_receipt_dt"] = dmy(df[["contb_receipt_dt"]])
```

# Data Munging
Double checking columns of interest to ensure everything looks ok
```{r Additional Data Munging}
table(df["election_year"], exclude = F)

#2102 is likely a a typo. Converting to 2012
df[which(df["election_year"] == 2102), "election_year"] = 2012

#Removing all values from 2008
df = df[df["election_year"] != 2008,]

#Check again to see that everything took place correctly
table(df["election_year"], exclude = F)
```
There are still 168 null values in the year column. Let's take a closer look

```{r null_Values}
head(df[is.na(df["election_year"]),])
summary(df[is.na(df["election_year"]),])
```
Seems like most of these are refunds. For now setting aside these nulls into their own dataframe for exploration later

```{r null_split}
df_null = df[is.na(df["election_year"]),]
df = df[!is.na(df["election_year"]),]
```

Further exploration seems to show that the null values in the memo columns are represented as *.
```{r find_na}
table(wi_df["memo_text"])
table(wi_df["memo_cd"])
```
The memo columns are of little interest at this moment so we'll continue on.  

## Univariate Analysis

At time of writing in terms of candidates I am particularly interested which candidates are receiving the most money
```{r Initial_Exploration}
temp_df = df %>% select(contbr_st, election_year, contb_receipt_amt) %>% 
                 group_by(contbr_st, election_year) %>%
                 summarise(Number_of_Contributions = n(),
                           Sum_of_Contributions = sum(contb_receipt_amt)
                           )
ggplot(temp_df, aes(x = as.factor(election_year), y = Number_of_Contributions, fill = contbr_st )) + geom_bar(stat = "identity", position = "dodge") + ggtitle("Count of Contributions per state")

ggplot(temp_df, aes(x = as.factor(election_year), y = Sum_of_Contributions, fill = contbr_st )) + geom_bar(stat = "identity", position = "dodge") + ggtitle("Sum of Contributions per state in Dollars") + scale_y_continuous(labels = dollar)
```
It's no surprise that Calfornia far outpaces Wisconsin in both the count and dollar value of contributions as California is much more populous. For both graphs it would be desirable to show the values as ratio of the populations. A quick Google search shows that the population of Wisconsin at  2014 is around 5.7 million people. For California it averages around 38.2 million. As there is no 2015 data, and obviously no 2016 data. Looking back to 2012 the state population changed less than 3% for each. As is such for simplicity we'll just the 2014 reported population to normalize the data'

```{r Population_ratio}
population_ratio = function(x, contbr_st) {
  # trace()
  ca_population = 38000000
  wi_population = 5700000
  if (all(contbr_st == "CA")) {
    return(x/ca_population)
  }
  if (all(contbr_st == "WI")) {
    return(x/wi_population)
  }
}

temp_df = temp_df %>% mutate(Ratio_of_Number_of_Contributions = population_ratio(Number_of_Contributions, contbr_st),
Ratio_of_Sum_of_Contributions = population_ratio(Sum_of_Contributions, contbr_st))

ggplot(temp_df, aes(x = as.factor(election_year), y = Ratio_of_Number_of_Contributions , fill = contbr_st )) + geom_bar(stat = "identity", position = "dodge") + ggtitle("Population Ratio of Count of Contributions per state")

ggplot(temp_df, aes(x = as.factor(election_year), y = Ratio_of_Sum_of_Contributions, fill = contbr_st)) + geom_bar(stat = "identity", position = "dodge") + ggtitle("Population Ratio of Sum of Contributions per state in Dollars") + scale_y_continuous(labels = dollar)
```
Even after after accounting for the population it seems that people from Wisconsin donated less per year, and also less people from Wisconsin donated to political campaigns.

```{r top_candidates_per_date}
temp_df = df %>% select(cand_nm, contb_receipt_amt, contbr_st) %>% group_by(cand_nm, contbr_st) %>% summarise(total_receipts = sum(contb_receipt_amt)) %>% group_by(contbr_st) %>% top_n(n = 5)


ggplot(temp_df, aes(x = as.factor(cand_nm), y = total_receipts, fill = contbr_st)) + geom_bar(stat = "identity", position = "dodge") + ggtitle(" Sum of Contributions per State per Candidate in Dollars") + scale_y_continuous(labels = dollar)
```
As expected California contributes more overall. Also as expected Wisconsin contributed more to Mitt Romney than Barack Obama. The states also had the same pairings for top contributions to candidates, except for Jeb Bush and Scott Walker. There's little surprise that Wisconsin prefers to contribute more dollars to its governer Jeb Bush

```{r top_candidates_per_date}
temp_df = df %>% select(contbr_employer, contb_receipt_amt) %>% group_by(contbr_employer) %>% summarise(total_receipts = sum(contb_receipt_amt)) %>% top_n(n = 5)


ggplot(temp_df, aes(x = as.factor(contbr_employer), y = total_receipts)) + geom_bar(stat = "identity") + ggtitle(" Sum of Contributions by Employer") + scale_y_continuous(labels = dollar)
```
```{r Histogram_of_Contributions}
ggplot(df, aes(x = contb_receipt_amt)) + geom_histogram()
```

#Questions
What employer?  
Contributions per election type?  
Contributions over time?  

Do some comparisons for the states
Histogram or density plot of contribution amount per state
Contribution count over time for states


# Univariate Analysis

### What is the structure of your dataset?

### What is/are the main feature(s) of interest in your dataset?

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

### Did you create any new variables from existing variables in the dataset?

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?



# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}

```

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection

# Appendix
## File Links
http://www.fec.gov/disclosurep/pnational.do
ftp://ftp.fec.gov/FEC/Presidential_Map/2012/P00000001/P00000001-CA.zip  
ftp://ftp.fec.gov/FEC/Presidential_Map/2012/P00000001/P00000001-WI.zip  
ftp://ftp.fec.gov/FEC/Presidential_Map/2016/P00000001/P00000001-CA.zip  
ftp://ftp.fec.gov/FEC/Presidential_Map/2016/P00000001/P00000001-WI.zip  

#Project Rubric
https://docs.google.com/document/d/1L2Wwofs6D8Crd0QLZ1-RxBHlVoBZ3mec2xWgxrmUs5I/pub?embedded=true

#Examples
https://s3.amazonaws.com/udacity-hosted-downloads/ud651/diamondsExample.html  
https://s3.amazonaws.com/udacity-hosted-downloads/ud651/AtlanticHurricaneTracking.html  
https://s3.amazonaws.com/udacity-hosted-downloads/ud651/GeographyOfAmericanMusic.html  

#Dataset Reference
ftp://ftp.fec.gov/FEC/Presidential_Map/2016/DATA_DICTIONARIES/CONTRIBUTOR_FORMAT.txt  
https://docs.google.com/document/d/1qEcwltBMlRYZT-l699-71TzInWfk4W9q5rTCSvDVMpc/pub?embedded=true